
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temporal OMS Demo - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è Workflow –∏ Activity</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        .architecture {
            display: flex;
            justify-content: space-between;
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #e9ecef;
        }
        .component {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            min-width: 200px;
        }
        .component.client { border-left: 5px solid #3498db; }
        .component.workflow { border-left: 5px solid #e74c3c; }
        .component.activity { border-left: 5px solid #27ae60; }
        .component.worker { border-left: 5px solid #f39c12; }
        
        .workflow-visual {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 30px 0;
        }
        .workflow-step {
            padding: 20px;
            border-radius: 10px;
            background: white;
            border: 2px solid #e0e0e0;
            transition: all 0.5s ease;
            position: relative;
            overflow: hidden;
        }
        .workflow-step::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 0;
            background: linear-gradient(90deg, transparent, rgba(52, 152, 219, 0.1));
            transition: width 3s linear;
        }
        .workflow-step.executing::before {
            width: 100%;
        }
        .workflow-step.active {
            border-color: #3498db;
            background: #e3f2fd;
            transform: scale(1.02);
        }
        .workflow-step.completed {
            border-color: #27ae60;
            background: #e8f5e8;
        }
        .workflow-step.error {
            border-color: #e74c3c;
            background: #fde8e6;
        }
        
        .activity-call {
            margin: 10px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #27ae60;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { background: #f8f9fa; }
            50% { background: #e8f5e8; }
            100% { background: #f8f9fa; }
        }
        
        .controls {
            text-align: center;
            margin: 30px 0;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        button:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }
        
        .logs {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-radius: 3px;
        }
        .log-workflow { background: rgba(231, 76, 60, 0.2); }
        .log-activity { background: rgba(39, 174, 96, 0.2); }
        .log-client { background: rgba(52, 152, 219, 0.2); }
        .log-signal { background: rgba(243, 156, 18, 0.2); }
        
        .status-indicators {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        .status-item {
            text-align: center;
            padding: 10px;
        }
        .status-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin: 0 auto 5px;
            background: #bdc3c7;
        }
        .status-dot.active { background: #27ae60; animation: blink 1s infinite; }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .timeline {
            height: 4px;
            background: #e0e0e0;
            margin: 20px 0;
            border-radius: 2px;
            position: relative;
        }
        .timeline-progress {
            height: 100%;
            background: #3498db;
            border-radius: 2px;
            width: 0%;
            transition: width 0.5s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Temporal OMS Demo - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è Workflow –∏ Activity</h1>
        
        <div class="architecture">
            <div class="component client">
                <h3>üë§ –ö–ª–∏–µ–Ω—Ç</h3>
                <p>–ó–∞–ø—É—Å–∫–∞–µ—Ç Workflow</p>
                <div class="status-dot" id="client-status"></div>
            </div>
            <div class="component workflow">
                <h3>üîÑ Workflow</h3>
                <p>–û—Ä–∫–µ—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å</p>
                <div class="status-dot" id="workflow-status"></div>
            </div>
            <div class="component activity">
                <h3>üîß Activity</h3>
                <p>–í—ã–ø–æ–ª–Ω—è–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏</p>
                <div class="status-dot" id="activity-status"></div>
            </div>
            <div class="component worker">
                <h3>‚öôÔ∏è Worker</h3>
                <p>–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–¥–∞—á–∏</p>
                <div class="status-dot" id="worker-status"></div>
            </div>
        </div>

        <div class="timeline">
            <div class="timeline-progress" id="timeline-progress"></div>
        </div>

        <div class="workflow-visual">
            <div class="workflow-step" id="step-created">
                <h3>1. üìù –°–û–ó–î–ê–ù–ò–ï –ó–ê–ö–ê–ó–ê</h3>
                <p>–ö–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑ –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç Workflow</p>
                <div class="activity-call" id="activity-created" style="display: none;">
                    <strong>üéØ Workflow ‚Üí Activity:</strong> –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –∑–∞–∫–∞–∑–∞
                </div>
            </div>
            
            <div class="workflow-step" id="step-inventory">
                <h3>2. üì¶ –ü–†–û–í–ï–†–ö–ê –ó–ê–ü–ê–°–û–í</h3>
                <p>Workflow –≤—ã–∑—ã–≤–∞–µ—Ç Activity –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è —Ç–æ–≤–∞—Ä–æ–≤</p>
                <div class="activity-call" id="activity-inventory" style="display: none;">
                    <strong>üîÑ Workflow ‚Üí Activity:</strong> checkInventory(items)<br>
                    <em>‚è±Ô∏è –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è 3 —Å–µ–∫—É–Ω–¥—ã...</em>
                </div>
            </div>
            
            <div class="workflow-step" id="step-payment">
                <h3>3. üí≥ –û–ë–†–ê–ë–û–¢–ö–ê –ü–õ–ê–¢–ï–ñ–ê</h3>
                <p>Workflow –≤—ã–∑—ã–≤–∞–µ—Ç Activity –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–∞</p>
                <div class="activity-call" id="activity-payment" style="display: none;">
                    <strong>üîÑ Workflow ‚Üí Activity:</strong> processPayment(paymentInfo, amount)<br>
                    <em>‚è±Ô∏è –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è 4 —Å–µ–∫—É–Ω–¥—ã...</em>
                </div>
            </div>
            
            <div class="workflow-step" id="step-preparing">
                <h3>4. üéÅ –ü–û–î–ì–û–¢–û–í–ö–ê –ö –û–¢–ü–†–ê–í–ö–ï</h3>
                <p>Workflow –≤—ã–∑—ã–≤–∞–µ—Ç Activity –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∑–∞–∫–∞–∑–∞</p>
                <div class="activity-call" id="activity-preparing" style="display: none;">
                    <strong>üîÑ Workflow ‚Üí Activity:</strong> prepareForShipment(orderId, items)<br>
                    <em>‚è±Ô∏è –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è 3 —Å–µ–∫—É–Ω–¥—ã...</em>
                </div>
            </div>
            
            <div class="workflow-step" id="step-shipped">
                <h3>5. üöö –û–¢–ü–†–ê–í–ö–ê –ó–ê–ö–ê–ó–ê</h3>
                <p>Workflow –≤—ã–∑—ã–≤–∞–µ—Ç Activity –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–∫–∞–∑–∞</p>
                <div class="activity-call" id="activity-shipped" style="display: none;">
                    <strong>üîÑ Workflow ‚Üí Activity:</strong> shipOrder(orderId, packageId, address)<br>
                    <em>‚è±Ô∏è –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è 3 —Å–µ–∫—É–Ω–¥—ã...</em>
                </div>
            </div>
            
            <div class="workflow-step" id="step-delivered">
                <h3>6. ‚úÖ –î–û–°–¢–ê–í–ö–ê</h3>
                <p>Workflow –∑–∞–≤–µ—Ä—à–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –∏ —É–≤–µ–¥–æ–º–ª—è–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞</p>
                <div class="activity-call" id="activity-delivered" style="display: none;">
                    <strong>üîÑ Workflow ‚Üí Activity:</strong> notifyCustomer(email, message)<br>
                    <em>‚è±Ô∏è –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è 2 —Å–µ–∫—É–Ω–¥—ã...</em>
                </div>
            </div>
        </div>

        <div class="controls">
            <button onclick="startWorkflow()">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å Workflow</button>
            <button onclick="startWorkflowWithCancel()">üõë –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å –æ—Ç–º–µ–Ω–æ–π</button>
            <button onclick="resetDemo()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å –¥–µ–º–æ</button>
        </div>

        <div class="status-indicators">
            <div class="status-item">
                <div class="status-dot" id="status-client"></div>
                <div>–ö–ª–∏–µ–Ω—Ç</div>
            </div>
            <div class="status-item">
                <div class="status-dot" id="status-workflow"></div>
                <div>Workflow</div>
            </div>
            <div class="status-item">
                <div class="status-dot" id="status-activity"></div>
                <div>Activity</div>
            </div>
            <div class="status-item">
                <div class="status-dot" id="status-worker"></div>
                <div>Worker</div>
            </div>
        </div>

        <h2>üìã –õ–æ–≥ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤</h2>
        <div id="logs" class="logs"></div>
    </div>

    <script>
        let currentWorkflow = null;
        const logsElement = document.getElementById('logs');
        const totalSteps = 6;

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
        function updateStatus(component, isActive) {
            const dot = document.getElementById(`${component}-status`);
            if (dot) {
                dot.className = `status-dot ${isActive ? 'active' : ''}`;
            }
            const statusDot = document.getElementById(`status-${component}`);
            if (statusDot) {
                statusDot.className = `status-dot ${isActive ? 'active' : ''}`;
            }
        }

        function activateStep(stepId) {
            document.querySelectorAll('.workflow-step').forEach(step => {
                step.classList.remove('active', 'completed', 'executing');
            });
            const step = document.getElementById(stepId);
            if (step) {
                step.classList.add('active', 'executing');
            }
        }

        function completeStep(stepId) {
            const step = document.getElementById(stepId);
            if (step) {
                step.classList.remove('active', 'executing');
                step.classList.add('completed');
            }
            updateTimeline();
        }

        function showActivity(activityId) {
            const activity = document.getElementById(activityId);
            if (activity) {
                activity.style.display = 'block';
            }
        }

        function hideActivity(activityId) {
            const activity = document.getElementById(activityId);
            if (activity) {
                activity.style.display = 'none';
            }
        }

        function updateTimeline() {
            const completedSteps = document.querySelectorAll('.workflow-step.completed').length;
            const progress = (completedSteps / totalSteps) * 100;
            document.getElementById('timeline-progress').style.width = `${progress}%`;
        }

        function log(message, type = 'workflow') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            logsElement.appendChild(logEntry);
            logsElement.scrollTop = logsElement.scrollHeight;
        }

        // –ò–º–∏—Ç–∞—Ü–∏—è Activity —Ñ—É–Ω–∫—Ü–∏–π —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º–∏ —Ç–∞–π–º–µ—Ä–∞–º–∏
        const activities = {
            async checkInventory(items) {
                updateStatus('activity', true);
                showActivity('activity-inventory');
                log('üîç Activity: –ù–∞—á–∞–ª–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–ø–∞—Å–æ–≤...', 'activity');
                
                await delay(3000); // 3 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏
                
                log('‚úÖ Activity: –ó–∞–ø–∞—Å—ã –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã, —Ç–æ–≤–∞—Ä—ã –¥–æ—Å—Ç—É–ø–Ω—ã', 'activity');
                updateStatus('activity', false);
                hideActivity('activity-inventory');
                return { available: true, unavailableItems: [] };
            },

            async processPayment(paymentInfo, amount) {
                updateStatus('activity', true);
                showActivity('activity-payment');
                log('üí≥ Activity: –ù–∞—á–∞–ª–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–∞...', 'activity');
                
                await delay(4000); // 4 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏
                
                log('‚úÖ Activity: –ü–ª–∞—Ç–µ–∂ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω', 'activity');
                updateStatus('activity', false);
                hideActivity('activity-payment');
                return { success: true, transactionId: 'TXN_' + Date.now() };
            },

            async prepareForShipment(orderId, items) {
                updateStatus('activity', true);
                showActivity('activity-preparing');
                log('üì¶ Activity: –ù–∞—á–∞–ª–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ...', 'activity');
                
                await delay(3000); // 3 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏
                
                log('‚úÖ Activity: –ó–∞–∫–∞–∑ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ', 'activity');
                updateStatus('activity', false);
                hideActivity('activity-preparing');
                return { ready: true, packageId: 'PKG_' + orderId };
            },

            async shipOrder(orderId, packageId, address) {
                updateStatus('activity', true);
                showActivity('activity-shipped');
                log('üöö Activity: –ù–∞—á–∞–ª–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–∫–∞–∑–∞...', 'activity');
                
                await delay(3000); // 3 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏
                
                const trackingNumber = 'TRK_' + Math.random().toString(36).substr(2, 9).toUpperCase();
                log(`‚úÖ Activity: –ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω, —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä: ${trackingNumber}`, 'activity');
                updateStatus('activity', false);
                hideActivity('activity-shipped');
                return { shipped: true, trackingNumber };
            },

            async notifyCustomer(email, message, orderId) {
                updateStatus('activity', true);
                showActivity('activity-delivered');
                log('üìß Activity: –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç—É...', 'activity');
                
                await delay(2000); // 2 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏
                
                log('‚úÖ Activity: –ö–ª–∏–µ–Ω—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω', 'activity');
                updateStatus('activity', false);
                hideActivity('activity-delivered');
            }
        };

        // Workflow –ø—Ä–æ—Ü–µ—Å—Å–∞ –∑–∞–∫–∞–∑–∞
        async function orderWorkflow(order, shouldCancel = false) {
            updateStatus('workflow', true);
            log('üé¨ Workflow: –ó–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–∞ ' + order.id, 'workflow');
            
            activateStep('step-created');
            showActivity('activity-created');
            await delay(1000);
            completeStep('step-created');
            hideActivity('activity-created');

            try {
                // –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–∞—Å–æ–≤
                log('üì¶ Workflow: –í—ã–∑–æ–≤ Activity checkInventory', 'workflow');
                activateStep('step-inventory');
                const inventoryResult = await activities.checkInventory(order.items);
                if (!inventoryResult.available) {
                    throw new Error('–¢–æ–≤–∞—Ä—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã');
                }
                completeStep('step-inventory');

                // –ò–º–∏—Ç–∞—Ü–∏—è –æ—Ç–º–µ–Ω—ã
                if (shouldCancel) {
                    setTimeout(() => {
                        log('üõë Signal: –ü–æ–ª—É—á–µ–Ω —Å–∏–≥–Ω–∞–ª –æ—Ç–º–µ–Ω—ã –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞', 'signal');
                        currentWorkflow.cancelReason = '–ö–ª–∏–µ–Ω—Ç –ø–µ—Ä–µ–¥—É–º–∞–ª';
                    }, 5000);
                }

                if (currentWorkflow.cancelReason) {
                    return await handleCancellation(order, currentWorkflow.cancelReason);
                }

                // –®–∞–≥ 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–∞
                log('üí∞ Workflow: –í—ã–∑–æ–≤ Activity processPayment', 'workflow');
                activateStep('step-payment');
                const paymentResult = await activities.processPayment(order.payment, order.totalAmount);
                if (!paymentResult.success) {
                    throw new Error('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–∞');
                }
                completeStep('step-payment');

                if (currentWorkflow.cancelReason) {
                    return await handleCancellation(order, currentWorkflow.cancelReason);
                }

                // –®–∞–≥ 3: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ
                log('üì¶ Workflow: –í—ã–∑–æ–≤ Activity prepareForShipment', 'workflow');
                activateStep('step-preparing');
                const preparationResult = await activities.prepareForShipment(order.id, order.items);
                completeStep('step-preparing');

                if (currentWorkflow.cancelReason) {
                    return await handleCancellation(order, currentWorkflow.cancelReason);
                }

                // –®–∞–≥ 4: –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–∫–∞–∑–∞
                log('üöö Workflow: –í—ã–∑–æ–≤ Activity shipOrder', 'workflow');
                activateStep('step-shipped');
                const shippingResult = await activities.shipOrder(order.id, preparationResult.packageId, order.customer.address);
                completeStep('step-shipped');

                // –®–∞–≥ 5: –î–æ—Å—Ç–∞–≤–∫–∞ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                log('üéØ Workflow: –í—ã–∑–æ–≤ Activity notifyCustomer', 'workflow');
                activateStep('step-delivered');
                await activities.notifyCustomer(order.customer.email, '–ó–∞–∫–∞–∑ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω!', order.id);
                completeStep('step-delivered');

                log('‚úÖ Workflow: –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–∫–∞–∑–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω!', 'workflow');
                updateStatus('workflow', false);
                return {
                    success: true,
                    orderId: order.id,
                    status: 'DELIVERED',
                    trackingNumber: shippingResult.trackingNumber
                };

            } catch (error) {
                log('‚ùå Workflow: –û—à–∏–±–∫–∞: ' + error.message, 'workflow');
                updateStatus('workflow', false);
                markStepError();
                return {
                    success: false,
                    orderId: order.id,
                    status: 'CANCELLED',
                    error: error.message
                };
            }
        }

        async function handleCancellation(order, reason) {
            log('üõë Workflow: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–∞...', 'workflow');
            await activities.notifyCustomer(order.customer.email, '–ó–∞–∫–∞–∑ –æ—Ç–º–µ–Ω–µ–Ω: ' + reason, order.id);
            updateStatus('workflow', false);
            markStepCancelled();
            return {
                success: false,
                orderId: order.id,
                status: 'CANCELLED',
                reason: reason
            };
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function markStepError() {
            document.querySelectorAll('.workflow-step.active').forEach(step => {
                step.classList.remove('active', 'executing');
                step.classList.add('error');
            });
        }

        function markStepCancelled() {
            document.querySelectorAll('.workflow-step.active').forEach(step => {
                step.classList.remove('active', 'executing');
                step.classList.add('error');
            });
        }

        // –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–µ–º–æ
        function startWorkflow() {
            resetDemo();
            updateStatus('client', true);
            log('üë§ –ö–ª–∏–µ–Ω—Ç: –ó–∞–ø—É—Å–∫ –Ω–æ–≤–æ–≥–æ workflow –∑–∞–∫–∞–∑–∞', 'client');
            
            const order = {
                id: 'ORD_' + Date.now(),
                customer: { name: '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤', email: 'ivan@example.com' },
                items: [{ product: '–°–º–∞—Ä—Ç—Ñ–æ–Ω', quantity: 1, price: 50000 }],
                totalAmount: 50000,
                payment: { method: 'credit_card' }
            };
            
            currentWorkflow = { cancelReason: null };
            orderWorkflow(order, false).then(result => {
                updateStatus('client', false);
                log('üéâ –ö–ª–∏–µ–Ω—Ç: –ü–æ–ª—É—á–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ' + JSON.stringify(result, null, 2), 'client');
            });
        }

        function startWorkflowWithCancel() {
            resetDemo();
            updateStatus('client', true);
            log('üë§ –ö–ª–∏–µ–Ω—Ç: –ó–∞–ø—É—Å–∫ workflow —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –æ—Ç–º–µ–Ω—ã', 'client');
            
            const order = {
                id: 'ORD_' + Date.now(),
                customer: { name: '–ú–∞—Ä–∏—è –°–∏–¥–æ—Ä–æ–≤–∞', email: 'maria@example.com' },
                items: [{ product: '–ù–æ—É—Ç–±—É–∫', quantity: 1, price: 80000 }],
                totalAmount: 80000,
                payment: { method: 'credit_card' }
            };
            
            currentWorkflow = { cancelReason: null };
            orderWorkflow(order, true).then(result => {
                updateStatus('client', false);
                log('üéâ –ö–ª–∏–µ–Ω—Ç: –ü–æ–ª—É—á–µ–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ' + JSON.stringify(result, null, 2), 'client');
            });
        }

        function resetDemo() {
            logsElement.innerHTML = '';
            document.querySelectorAll('.workflow-step').forEach(step => {
                step.classList.remove('active', 'completed', 'error', 'executing');
            });
            document.querySelectorAll('.activity-call').forEach(activity => {
                activity.style.display = 'none';
            });
            document.querySelectorAll('.status-dot').forEach(dot => {
                dot.className = 'status-dot';
            });
            document.getElementById('timeline-progress').style.width = '0%';
            currentWorkflow = null;
            log('üîÑ –î–µ–º–æ —Å–±—Ä–æ—à–µ–Ω–æ. –ì–æ—Ç–æ–≤–æ –∫ –∑–∞–ø—É—Å–∫—É –Ω–æ–≤–æ–≥–æ workflow.', 'workflow');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        log('üåê Temporal OMS Visual Demo –∑–∞–≥—Ä—É–∂–µ–Ω. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –∑–∞–ø—É—Å–∫–∞ workflow.', 'workflow');
        updateStatus('worker', true); // Worker –≤—Å–µ–≥–¥–∞ –∞–∫—Ç–∏–≤–µ–Ω
    </script>
</body>
</html>