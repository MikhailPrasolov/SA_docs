<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temporal OMS Demo - Live Monitoring</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            min-height: calc(100vh - 20px);
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 20px;
            height: calc(100vh - 200px);
        }

        @media (max-width: 1024px) {
            .dashboard {
                grid-template-columns: 1fr;
                height: auto;
            }
        }

        .panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border: 1px solid #e9ecef;
            display: flex;
            flex-direction: column;
            min-height: 0; /* –î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã flex –≤–Ω—É—Ç—Ä–∏ */
        }

        .panel-content {
            flex: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        @media (max-width: 768px) {
            .panel {
                padding: 15px;
            }
        }

        .panel h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.4em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .workflow-status {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 5px solid #3498db;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .workflow-status.completed {
            border-left-color: #27ae60;
        }

        .workflow-status.error {
            border-left-color: #e74c3c;
        }

        .workflow-status.running {
            border-left-color: #f39c12;
        }

        .workflow-status.cancelled {
            border-left-color: #95a5a6;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            margin-left: 10px;
        }

        .status-created { background: #3498db; color: white; }
        .status-inventory { background: #9b59b6; color: white; }
        .status-payment { background: #f39c12; color: white; }
        .status-preparing { background: #d35400; color: white; }
        .status-shipped { background: #27ae60; color: white; }
        .status-delivered { background: #2ecc71; color: white; }
        .status-cancelled { background: #95a5a6; color: white; }

        .log-container {
            background: #2c3e50;
            color: #ecf0f1;
            border-radius: 8px;
            padding: 15px;
            height: 500px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            line-height: 1.4;
            display: flex;
            flex-direction: column;
        }

        .log-scrollable {
            flex: 1;
            overflow-y: auto;
            max-height: 100%;
        }

        .log-scrollable::-webkit-scrollbar {
            width: 8px;
        }

        .log-scrollable::-webkit-scrollbar-track {
            background: #34495e;
            border-radius: 4px;
        }

        .log-scrollable::-webkit-scrollbar-thumb {
            background: #3498db;
            border-radius: 4px;
        }

        .log-scrollable::-webkit-scrollbar-thumb:hover {
            background: #2980b9;
        }

        @media (max-width: 768px) {
            .log-container {
                height: 300px;
                font-size: 0.8em;
            }
        }

        .log-entry {
            margin-bottom: 8px;
            padding: 5px;
            border-radius: 4px;
        }

        .log-entry.info { background: rgba(52, 152, 219, 0.1); }
        .log-entry.warn { background: rgba(243, 156, 18, 0.1); }
        .log-entry.error { background: rgba(231, 76, 60, 0.1); }
        .log-entry.success { background: rgba(46, 204, 113, 0.1); }

        .timestamp {
            color: #bdc3c7;
            font-size: 0.8em;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 120px;
        }

        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
            }
            
            button {
                min-width: auto;
                width: 100%;
            }
        }

        .btn-start {
            background: #27ae60;
            color: white;
        }

        .btn-start:hover {
            background: #219a52;
        }

        .btn-cancel {
            background: #e74c3c;
            color: white;
        }

        .btn-cancel:hover {
            background: #c0392b;
        }

        .btn-clear {
            background: #95a5a6;
            color: white;
        }

        .btn-clear:hover {
            background: #7f8c8d;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .workflow-progress {
            margin-top: 20px;
        }

        .progress-bar {
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            transition: width 0.5s ease;
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            font-size: 0.8em;
            color: #7f8c8d;
        }

        .activity-list {
            list-style: none;
        }

        .activity-item {
            padding: 10px;
            margin-bottom: 8px;
            background: white;
            border-radius: 6px;
            border-left: 4px solid #3498db;
            display: flex;
            justify-content: between;
            align-items: center;
        }

        .activity-item.completed {
            border-left-color: #27ae60;
            background: #f8fff9;
        }

        .activity-item.running {
            border-left-color: #f39c12;
            background: #fffbf0;
        }

        .activity-name {
            flex: 1;
            font-weight: bold;
        }

        .activity-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
        }

        .status-pending { background: #bdc3c7; color: white; }
        .status-running { background: #f39c12; color: white; }
        .status-completed { background: #27ae60; color: white; }
        .status-failed { background: #e74c3c; color: white; }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .pulse {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Temporal OMS Demo - Live Monitoring</h1>
            <p>–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è workflow –ø—Ä–æ—Ü–µ—Å—Å–∞ –∑–∞–∫–∞–∑–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</p>
        </div>

        <div class="dashboard">
            <div class="panel">
                <h2>üìä –°—Ç–∞—Ç—É—Å Workflow</h2>
                <div id="workflowStatus" class="workflow-status">
                    <div class="workflow-info">
                        <strong>ID:</strong> <span id="workflowId">-</span>
                        <span id="statusBadge" class="status-badge status-created">CREATED</span>
                    </div>
                    <div class="workflow-progress">
                        <div class="progress-bar">
                            <div id="progressFill" class="progress-fill" style="width: 0%"></div>
                        </div>
                        <div class="progress-steps">
                            <span>–°–æ–∑–¥–∞–Ω</span>
                            <span>–ó–∞–ø–∞—Å—ã</span>
                            <span>–ü–ª–∞—Ç–µ–∂</span>
                            <span>–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞</span>
                            <span>–û—Ç–ø—Ä–∞–≤–∫–∞</span>
                            <span>–î–æ—Å—Ç–∞–≤–∫–∞</span>
                        </div>
                    </div>
                    <div class="stats">
                        <div class="stat-card">
                            <div class="stat-number" id="totalOrders">0</div>
                            <div class="stat-label">–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="successfulOrders">0</div>
                            <div class="stat-label">–£—Å–ø–µ—à–Ω—ã—Ö</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="cancelledOrders">0</div>
                            <div class="stat-label">–û—Ç–º–µ–Ω–µ–Ω–Ω—ã—Ö</div>
                        </div>
                    </div>
                </div>

                <h3>üîß Activity –§—É–Ω–∫—Ü–∏–∏</h3>
                <ul id="activityList" class="activity-list">
                    <li class="activity-item">
                        <span class="activity-name">–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–∞—Å–æ–≤</span>
                        <span class="activity-status status-pending">–û–∂–∏–¥–∞–Ω–∏–µ</span>
                    </li>
                    <li class="activity-item">
                        <span class="activity-name">–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–∞</span>
                        <span class="activity-status status-pending">–û–∂–∏–¥–∞–Ω–∏–µ</span>
                    </li>
                    <li class="activity-item">
                        <span class="activity-name">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ</span>
                        <span class="activity-status status-pending">–û–∂–∏–¥–∞–Ω–∏–µ</span>
                    </li>
                    <li class="activity-item">
                        <span class="activity-name">–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–∫–∞–∑–∞</span>
                        <span class="activity-status status-pending">–û–∂–∏–¥–∞–Ω–∏–µ</span>
                    </li>
                    <li class="activity-item">
                        <span class="activity-name">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞</span>
                        <span class="activity-status status-pending">–û–∂–∏–¥–∞–Ω–∏–µ</span>
                    </li>
                </ul>

                <div class="controls">
                    <button class="btn-start" onclick="startWorkflow()">‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å Workflow</button>
                    <button class="btn-cancel" onclick="cancelWorkflow()">‚èπÔ∏è –û—Ç–º–µ–Ω–∏—Ç—å Workflow</button>
                    <button class="btn-clear" onclick="clearLogs()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
                </div>
            </div>

            <div class="panel">
                <h2>üìù –õ–æ–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</h2>
                <div class="panel-content">
                    <div id="logContainer" class="log-container">
                        <div class="log-scrollable">
                            <div class="log-entry info">
                                <span class="timestamp" id="currentTime"></span>
                                –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ. –ù–∞–∂–º–∏—Ç–µ "–ó–∞–ø—É—Å—Ç–∏—Ç—å Workflow" –¥–ª—è –Ω–∞—á–∞–ª–∞ –¥–µ–º–æ.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let workflowRunning = false;
        let currentWorkflowId = null;
        let logCount = 0;
        let totalOrders = 0;
        let successfulOrders = 0;
        let cancelledOrders = 0;

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è
        function updateCurrentTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = 
                now.toLocaleTimeString('ru-RU') + '.' + now.getMilliseconds().toString().padStart(3, '0');
        }

        setInterval(updateCurrentTime, 100);

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∞
        function addLog(message, type = 'info') {
            const logContainer = document.querySelector('.log-scrollable');
            const now = new Date();
            const timestamp = now.toLocaleTimeString('ru-RU') + '.' + now.getMilliseconds().toString().padStart(3, '0');
            
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.innerHTML = `<span class="timestamp">${timestamp}</span> ${message}`;
            
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            logCount++;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ workflow
        function updateWorkflowStatus(status, workflowId = null) {
            const statusElement = document.getElementById('workflowStatus');
            const badgeElement = document.getElementById('statusBadge');
            const progressFill = document.getElementById('progressFill');
            
            if (workflowId) {
                currentWorkflowId = workflowId;
                document.getElementById('workflowId').textContent = workflowId;
            }
            
            // –£–±–∏—Ä–∞–µ–º –≤—Å–µ –∫–ª–∞—Å—Å—ã —Å—Ç–∞—Ç—É—Å–∞
            statusElement.className = 'workflow-status';
            badgeElement.className = 'status-badge';
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å
            let progress = 0;
            switch(status) {
                case 'CREATED':
                    badgeElement.className += ' status-created';
                    badgeElement.textContent = '–°–û–ó–î–ê–ù';
                    progress = 0;
                    break;
                case 'INVENTORY_CHECKED':
                    badgeElement.className += ' status-inventory';
                    badgeElement.textContent = '–ó–ê–ü–ê–°–´ –ü–†–û–í–ï–†–ï–ù–´';
                    progress = 20;
                    updateActivityStatus(0, 'completed');
                    break;
                case 'PAYMENT_PROCESSED':
                    badgeElement.className += ' status-payment';
                    badgeElement.textContent = '–ü–õ–ê–¢–ï–ñ –û–ë–†–ê–ë–û–¢–ê–ù';
                    progress = 40;
                    updateActivityStatus(1, 'completed');
                    break;
                case 'PREPARING_FOR_SHIPMENT':
                    badgeElement.className += ' status-preparing';
                    badgeElement.textContent = '–ü–û–î–ì–û–¢–û–í–ö–ê –ö –û–¢–ü–†–ê–í–ö–ï';
                    progress = 60;
                    updateActivityStatus(2, 'completed');
                    break;
                case 'SHIPPED':
                    badgeElement.className += ' status-shipped';
                    badgeElement.textContent = '–û–¢–ü–†–ê–í–õ–ï–ù';
                    progress = 80;
                    updateActivityStatus(3, 'completed');
                    break;
                case 'DELIVERED':
                    badgeElement.className += ' status-delivered';
                    badgeElement.textContent = '–î–û–°–¢–ê–í–õ–ï–ù';
                    progress = 100;
                    updateActivityStatus(4, 'completed');
                    statusElement.className += ' completed';
                    workflowRunning = false;
                    successfulOrders++;
                    updateStats();
                    break;
                case 'CANCELLED':
                    badgeElement.className += ' status-cancelled';
                    badgeElement.textContent = '–û–¢–ú–ï–ù–ï–ù';
                    statusElement.className += ' cancelled';
                    workflowRunning = false;
                    cancelledOrders++;
                    updateStats();
                    break;
                case 'RUNNING':
                    badgeElement.className += ' status-created pulse';
                    badgeElement.textContent = '–í–´–ü–û–õ–ù–Ø–ï–¢–°–Ø';
                    statusElement.className += ' running';
                    workflowRunning = true;
                    break;
                case 'ERROR':
                    badgeElement.className += ' status-cancelled';
                    badgeElement.textContent = '–û–®–ò–ë–ö–ê';
                    statusElement.className += ' error';
                    workflowRunning = false;
                    break;
            }
            
            progressFill.style.width = `${progress}%`;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ activity
        function updateActivityStatus(index, status) {
            const activities = document.querySelectorAll('.activity-item');
            if (activities[index]) {
                const activity = activities[index];
                const statusElement = activity.querySelector('.activity-status');
                
                activity.className = 'activity-item';
                statusElement.className = 'activity-status';
                
                switch(status) {
                    case 'running':
                        activity.className += ' running';
                        statusElement.className += ' status-running';
                        statusElement.textContent = '–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è';
                        break;
                    case 'completed':
                        activity.className += ' completed';
                        statusElement.className += ' status-completed';
                        statusElement.textContent = '–ó–∞–≤–µ—Ä—à–µ–Ω–æ';
                        break;
                    case 'failed':
                        activity.className += ' error';
                        statusElement.className += ' status-failed';
                        statusElement.textContent = '–û—à–∏–±–∫–∞';
                        break;
                    default:
                        statusElement.className += ' status-pending';
                        statusElement.textContent = '–û–∂–∏–¥–∞–Ω–∏–µ';
                }
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            document.getElementById('totalOrders').textContent = totalOrders;
            document.getElementById('successfulOrders').textContent = successfulOrders;
            document.getElementById('cancelledOrders').textContent = cancelledOrders;
        }

        // WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
        let ws = null;
        let reconnectAttempts = 0;
        const maxReconnectAttempts = 5;

        function connectWebSocket() {
            try {
                ws = new WebSocket('ws://localhost:3000');
                
                ws.onopen = function() {
                    addLog('üîó –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ', 'success');
                    reconnectAttempts = 0;
                };
                
                ws.onmessage = function(event) {
                    try {
                        const data = JSON.parse(event.data);
                        handleWebSocketMessage(data);
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:', error);
                    }
                };
                
                ws.onclose = function() {
                    addLog('üîå –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º —Ä–∞–∑–æ—Ä–≤–∞–Ω–æ', 'warn');
                    if (reconnectAttempts < maxReconnectAttempts) {
                        setTimeout(() => {
                            reconnectAttempts++;
                            addLog(`üîÑ –ü–æ–ø—ã—Ç–∫–∞ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è ${reconnectAttempts}/${maxReconnectAttempts}...`, 'info');
                            connectWebSocket();
                        }, 2000);
                    }
                };
                
                ws.onerror = function(error) {
                    console.error('WebSocket –æ—à–∏–±–∫–∞:', error);
                };
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è WebSocket:', error);
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç WebSocket —Å–µ—Ä–≤–µ—Ä–∞
        function handleWebSocketMessage(data) {
            switch(data.type) {
                case 'welcome':
                    addLog(data.message, 'success');
                    break;
                    
                case 'workflow_started':
                    addLog(data.message, 'success');
                    updateWorkflowStatus('RUNNING');
                    break;
                    
                case 'workflow_created':
                    updateWorkflowStatus('RUNNING', data.workflowId);
                    addLog(data.message, 'info');
                    break;
                    
                case 'workflow_completed':
                    updateWorkflowStatus('DELIVERED');
                    addLog(data.message, 'success');
                    successfulOrders++;
                    updateStats();
                    break;
                    
                case 'workflow_cancelled':
                    updateWorkflowStatus('CANCELLED');
                    addLog(data.message, 'warn');
                    cancelledOrders++;
                    updateStats();
                    break;
                    
                case 'activity_started':
                    const activityMap = {
                        'checkInventory': 0,
                        'processPayment': 1,
                        'prepareOrderForShipment': 2,
                        'shipOrder': 3,
                        'notifyCustomer': 4
                    };
                    if (activityMap[data.activity] !== undefined) {
                        updateActivityStatus(activityMap[data.activity], 'running');
                    }
                    addLog(data.message, 'info');
                    break;
                    
                case 'activity_completed':
                    addLog(data.message, 'success');
                    break;
                    
                case 'activity_failed':
                    addLog(data.message, 'error');
                    break;
                    
                case 'cancellation_sent':
                    addLog(data.message, 'warn');
                    break;
                    
                case 'logs_cleared':
                    addLog(data.message, 'info');
                    break;
                    
                case 'log':
                    addLog(data.message, data.level || 'info');
                    break;
                    
                case 'error':
                    addLog(data.message, 'error');
                    break;
                    
                default:
                    addLog(data.message, 'info');
            }
        }

        // –ó–∞–ø—É—Å–∫ workflow —á–µ—Ä–µ–∑ WebSocket
        function startWorkflow() {
            if (workflowRunning) {
                addLog('Workflow —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è. –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.', 'warn');
                return;
            }

            if (!ws || ws.readyState !== WebSocket.OPEN) {
                addLog('‚ùå –ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É. –ó–∞–ø—É—Å—Ç–∏—Ç–µ live-server.js', 'error');
                return;
            }

            totalOrders++;
            updateStats();
            
            // –°–±—Ä–æ—Å —Å—Ç–∞—Ç—É—Å–æ–≤ activity
            for (let i = 0; i < 5; i++) {
                updateActivityStatus(i, 'pending');
            }
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –∑–∞–ø—É—Å–∫ workflow
            ws.send(JSON.stringify({
                type: 'start_workflow',
                timestamp: new Date().toISOString()
            }));
        }

        // –û—Ç–º–µ–Ω–∞ workflow —á–µ—Ä–µ–∑ WebSocket
        function cancelWorkflow() {
            if (!workflowRunning || !currentWorkflowId) {
                addLog('–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ workflow –¥–ª—è –æ—Ç–º–µ–Ω—ã.', 'warn');
                return;
            }
            
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                addLog('‚ùå –ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É', 'error');
                return;
            }
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –æ—Ç–º–µ–Ω—É workflow
            ws.send(JSON.stringify({
                type: 'cancel_workflow',
                workflowId: currentWorkflowId,
                timestamp: new Date().toISOString()
            }));
        }

        // –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤ —á–µ—Ä–µ–∑ WebSocket
        function clearLogs() {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                // –ï—Å–ª–∏ –Ω–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è, –æ—á–∏—â–∞–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
                const logScrollable = document.querySelector('.log-scrollable');
                logScrollable.innerHTML = '';
                addLog('–õ–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã', 'info');
                return;
            }
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –æ—á–∏—Å—Ç–∫—É –ª–æ–≥–æ–≤
            ws.send(JSON.stringify({
                type: 'clear_logs',
                timestamp: new Date().toISOString()
            }));
        }


        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            updateCurrentTime();
            updateStats();
            addLog('üîÑ –°–∏—Å—Ç–µ–º–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É...', 'info');
            connectWebSocket();
        });
    </script>
</body>
</html>
           