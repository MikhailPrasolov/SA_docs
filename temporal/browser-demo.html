<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temporal OMS Demo - –ë—Ä–∞—É–∑–µ—Ä–Ω–∞—è –≤–µ—Ä—Å–∏—è</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .demo-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #fafafa;
        }
        .workflow-step {
            padding: 10px;
            margin: 5px 0;
            border-left: 4px solid #3498db;
            background: white;
            transition: all 0.3s ease;
        }
        .workflow-step.active {
            border-left-color: #27ae60;
            background: #e8f5e8;
        }
        .workflow-step.error {
            border-left-color: #e74c3c;
            background: #fde8e6;
        }
        .workflow-step.cancelled {
            border-left-color: #f39c12;
            background: #fef5e7;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background: #2980b9;
        }
        button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }
        .log {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            height: 200px;
            overflow-y: auto;
            margin-top: 20px;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        .status-created { background: #3498db; color: white; }
        .status-inventory { background: #9b59b6; color: white; }
        .status-payment { background: #f39c12; color: white; }
        .status-preparing { background: #d35400; color: white; }
        .status-shipped { background: #27ae60; color: white; }
        .status-delivered { background: #16a085; color: white; }
        .status-cancelled { background: #e74c3c; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Temporal OMS Demo - –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ</h1>
        
        <div class="demo-section">
            <h2>üì¶ –ü—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–∞ (Workflow)</h2>
            <div id="workflow-steps">
                <div class="workflow-step" id="step-created">
                    <strong>1. –°–û–ó–î–ê–ù–ò–ï –ó–ê–ö–ê–ó–ê</strong> - –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω –∏ –æ–∂–∏–¥–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏
                </div>
                <div class="workflow-step" id="step-inventory">
                    <strong>2. –ü–†–û–í–ï–†–ö–ê –ó–ê–ü–ê–°–û–í</strong> - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å–∫–ª–∞–¥–µ
                </div>
                <div class="workflow-step" id="step-payment">
                    <strong>3. –û–ë–†–ê–ë–û–¢–ö–ê –ü–õ–ê–¢–ï–ñ–ê</strong> - –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
                </div>
                <div class="workflow-step" id="step-preparing">
                    <strong>4. –ü–û–î–ì–û–¢–û–í–ö–ê –ö –û–¢–ü–†–ê–í–ö–ï</strong> - –°–±–æ—Ä–∫–∞ –∏ —É–ø–∞–∫–æ–≤–∫–∞ –∑–∞–∫–∞–∑–∞
                </div>
                <div class="workflow-step" id="step-shipped">
                    <strong>5. –û–¢–ü–†–ê–í–ö–ê –ó–ê–ö–ê–ó–ê</strong> - –ü–µ—Ä–µ–¥–∞—á–∞ –≤ —Å–ª—É–∂–±—É –¥–æ—Å—Ç–∞–≤–∫–∏
                </div>
                <div class="workflow-step" id="step-delivered">
                    <strong>6. –î–û–°–¢–ê–í–ö–ê</strong> - –ó–∞–∫–∞–∑ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω –∫–ª–∏–µ–Ω—Ç—É
                </div>
            </div>
        </div>

        <div class="demo-section">
            <h2>üéÆ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–µ–º–æ</h2>
            <button onclick="startWorkflow()">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å —É—Å–ø–µ—à–Ω—ã–π –∑–∞–∫–∞–∑</button>
            <button onclick="startWorkflowWithCancel()">üõë –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å –æ—Ç–º–µ–Ω–æ–π</button>
            <button onclick="resetDemo()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å –¥–µ–º–æ</button>
            
            <div id="current-status" class="status status-created">
                –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å: –°–û–ó–î–ê–ù
            </div>
        </div>

        <div class="demo-section">
            <h2>üìù –õ–æ–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (Activity —Ñ—É–Ω–∫—Ü–∏–∏)</h2>
            <div id="log" class="log"></div>
        </div>

        <div class="demo-section">
            <h2>üí° –ö–æ–Ω—Ü–µ–ø—Ü–∏–∏ Temporal</h2>
            <ul>
                <li><strong>Workflow</strong> - –î–æ–ª–≥–æ–∂–∏–≤—É—â–∏–π –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–∫–∞–∑–∞)</li>
                <li><strong>Activity</strong> - –û—Ç–¥–µ–ª—å–Ω—ã–µ –±–∏–∑–Ω–µ—Å-–æ–ø–µ—Ä–∞—Ü–∏–∏ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–∞—Å–æ–≤, –ø–ª–∞—Ç–µ–∂ –∏ —Ç.–¥.)</li>
                <li><strong>–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å</strong> - –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ—Å–ª–µ "—Å–±–æ–µ–≤"</li>
                <li><strong>–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º–æ—Å—Ç—å</strong> - –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</li>
                <li><strong>–°–∏–≥–Ω–∞–ª—ã</strong> - –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –∑–∞–ø—É—â–µ–Ω–Ω—ã–º workflow (–æ—Ç–º–µ–Ω–∞)</li>
            </ul>
        </div>
    </div>

    <script>
        let currentWorkflow = null;
        let workflowSteps = [];
        const logElement = document.getElementById('log');
        const statusElement = document.getElementById('current-status');

        // –ò–º–∏—Ç–∞—Ü–∏—è Activity —Ñ—É–Ω–∫—Ü–∏–π
        const activities = {
            async checkInventory(items) {
                await delay(1000);
                log('üîç Activity: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–∞—Å–æ–≤...');
                await delay(500);
                return { available: true, unavailableItems: [] };
            },

            async processPayment(paymentInfo, amount) {
                await delay(800);
                log('üí≥ Activity: –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–∞...');
                await delay(600);
                return { success: true, transactionId: 'TXN_' + Date.now() };
            },

            async prepareForShipment(orderId, items) {
                await delay(600);
                log('üì¶ Activity: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ...');
                await delay(400);
                return { ready: true, packageId: 'PKG_' + orderId };
            },

            async shipOrder(orderId, packageId, address) {
                await delay(700);
                log('üöö Activity: –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–∫–∞–∑–∞...');
                await delay(500);
                return { 
                    shipped: true, 
                    trackingNumber: 'TRK_' + Math.random().toString(36).substr(2, 9).toUpperCase()
                };
            },

            async notifyCustomer(email, message, orderId) {
                await delay(300);
                log('üìß Activity: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞: ' + message);
            },

            async cancelOrder(orderId, reason) {
                await delay(500);
                log('üõë Activity: –û—Ç–º–µ–Ω–∞ –∑–∞–∫–∞–∑–∞: ' + reason);
                return { cancelled: true, refundAmount: Math.random() * 100 + 50 };
            }
        };

        // Workflow –ø—Ä–æ—Ü–µ—Å—Å–∞ –∑–∞–∫–∞–∑–∞
        async function orderWorkflow(order, shouldCancel = false) {
            log('üé¨ Workflow: –ó–∞–ø—É—Å–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–∞ ' + order.id);
            updateStatus('CREATED');
            activateStep('step-created');

            try {
                // –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–∞—Å–æ–≤
                log('üì¶ Workflow: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–∞—Å–æ–≤...');
                const inventoryResult = await activities.checkInventory(order.items);
                if (!inventoryResult.available) {
                    throw new Error('–¢–æ–≤–∞—Ä—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã');
                }
                updateStatus('INVENTORY_CHECKED');
                activateStep('step-inventory');

                // –ò–º–∏—Ç–∞—Ü–∏—è –æ—Ç–º–µ–Ω—ã
                if (shouldCancel) {
                    setTimeout(() => {
                        log('üõë Signal: –ü–æ–ª—É—á–µ–Ω —Å–∏–≥–Ω–∞–ª –æ—Ç–º–µ–Ω—ã –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞');
                        currentWorkflow.cancelReason = '–ö–ª–∏–µ–Ω—Ç –ø–µ—Ä–µ–¥—É–º–∞–ª';
                    }, 2000);
                }

                if (currentWorkflow.cancelReason) {
                    return await handleCancellation(order, currentWorkflow.cancelReason);
                }

                // –®–∞–≥ 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–∞
                log('üí∞ Workflow: –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–∞...');
                const paymentResult = await activities.processPayment(order.payment, order.totalAmount);
                if (!paymentResult.success) {
                    throw new Error('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–∞');
                }
                updateStatus('PAYMENT_PROCESSED');
                activateStep('step-payment');

                if (currentWorkflow.cancelReason) {
                    return await handleCancellation(order, currentWorkflow.cancelReason);
                }

                // –®–∞–≥ 3: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ
                log('üì¶ Workflow: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ...');
                const preparationResult = await activities.prepareForShipment(order.id, order.items);
                updateStatus('PREPARING_FOR_SHIPMENT');
                activateStep('step-preparing');

                if (currentWorkflow.cancelReason) {
                    return await handleCancellation(order, currentWorkflow.cancelReason);
                }

                // –®–∞–≥ 4: –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–∫–∞–∑–∞
                log('üöö Workflow: –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–∫–∞–∑–∞...');
                const shippingResult = await activities.shipOrder(order.id, preparationResult.packageId, order.customer.address);
                updateStatus('SHIPPED');
                activateStep('step-shipped');

                // –®–∞–≥ 5: –î–æ—Å—Ç–∞–≤–∫–∞
                log('üéØ Workflow: –î–æ—Å—Ç–∞–≤–∫–∞ –∑–∞–∫–∞–∑–∞...');
                await delay(1000);
                await activities.notifyCustomer(order.customer.email, '–ó–∞–∫–∞–∑ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω!', order.id);
                updateStatus('DELIVERED');
                activateStep('step-delivered');

                log('‚úÖ Workflow: –ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω!');
                return {
                    success: true,
                    orderId: order.id,
                    status: 'DELIVERED',
                    trackingNumber: shippingResult.trackingNumber
                };

            } catch (error) {
                log('‚ùå Workflow: –û—à–∏–±–∫–∞: ' + error.message);
                updateStatus('CANCELLED');
                markStepError();
                return {
                    success: false,
                    orderId: order.id,
                    status: 'CANCELLED',
                    error: error.message
                };
            }
        }

        async function handleCancellation(order, reason) {
            log('üõë Workflow: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–º–µ–Ω—ã...');
            const cancellationResult = await activities.cancelOrder(order.id, reason);
            await activities.notifyCustomer(order.customer.email, '–ó–∞–∫–∞–∑ –æ—Ç–º–µ–Ω–µ–Ω: ' + reason, order.id);
            updateStatus('CANCELLED');
            markStepCancelled();
            return {
                success: false,
                orderId: order.id,
                status: 'CANCELLED',
                reason: reason,
                refundAmount: cancellationResult.refundAmount
            };
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function updateStatus(status) {
            const statusText = {
                'CREATED': '–°–û–ó–î–ê–ù',
                'INVENTORY_CHECKED': '–ó–ê–ü–ê–°–´ –ü–†–û–í–ï–†–ï–ù–´',
                'PAYMENT_PROCESSED': '–ü–õ–ê–¢–ï–ñ –û–ë–†–ê–ë–û–¢–ê–ù',
                'PREPARING_FOR_SHIPMENT': '–ü–û–î–ì–û–¢–û–í–ö–ê –ö –û–¢–ü–†–ê–í–ö–ï',
                'SHIPPED': '–û–¢–ü–†–ê–í–õ–ï–ù',
                'DELIVERED': '–î–û–°–¢–ê–í–õ–ï–ù',
                'CANCELLED': '–û–¢–ú–ï–ù–ï–ù'
            };

            statusElement.textContent = `–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å: ${statusText[status]}`;
            statusElement.className = `status status-${status.toLowerCase()}`;
        }

        function activateStep(stepId) {
            document.querySelectorAll('.workflow-step').forEach(step => {
                step.classList.remove('active', 'error', 'cancelled');
            });
            document.getElementById(stepId).classList.add('active');
        }

        function markStepError() {
            document.querySelectorAll('.workflow-step.active').forEach(step => {
                step.classList.remove('active');
                step.classList.add('error');
            });
        }

        function markStepCancelled() {
            document.querySelectorAll('.workflow-step.active').forEach(step => {
                step.classList.remove('active');
                step.classList.add('cancelled');
            });
        }

        // –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–µ–º–æ
        function startWorkflow() {
            resetDemo();
            const order = {
                id: 'ORD_' + Date.now(),
                customer: { name: '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤', email: 'ivan@example.com' },
                items: [{ product: '–°–º–∞—Ä—Ç—Ñ–æ–Ω', quantity: 1, price: 50000 }],
                totalAmount: 50000,
                payment: { method: 'credit_card' }
            };
            
            currentWorkflow = { cancelReason: null };
            orderWorkflow(order, false).then(result => {
                log('üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç: ' + JSON.stringify(result, null, 2));
            });
        }

        function startWorkflowWithCancel() {
            resetDemo();
            const order = {
                id: 'ORD_' + Date.now(),
                customer: { name: '–ú–∞—Ä–∏—è –°–∏–¥–æ—Ä–æ–≤–∞', email: 'maria@example.com' },
                items: [{ product: '–ù–æ—É—Ç–±—É–∫', quantity: 1, price: 80000 }],
                totalAmount: 80000,
                payment: { method: 'credit_card' }
            };
            
            currentWorkflow = { cancelReason: null };
            orderWorkflow(order, true).then(result => {
                log('üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç: ' + JSON.stringify(result, null, 2));
            });
        }

        function resetDemo() {
            logElement.innerHTML = '';
            document.querySelectorAll('.workflow-step').forEach(step => {
                step.classList.remove('active', 'error', 'cancelled');
            });
            updateStatus('CREATED');
            currentWorkflow = null;
            log('üîÑ –î–µ–º–æ —Å–±—Ä–æ—à–µ–Ω–æ. –ì–æ—Ç–æ–≤–æ –∫ –∑–∞–ø—É—Å–∫—É –Ω–æ–≤–æ–≥–æ workflow.');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        log('üåê Temporal OMS Demo –∑–∞–≥—Ä—É–∂–µ–Ω. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –∑–∞–ø—É—Å–∫–∞ workflow.');
    </script>
</body>
</html>